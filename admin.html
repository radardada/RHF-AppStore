<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Undangan Eksklusif</title>
  <style>
    /* Style sama seperti sebelumnya, saya ringkas */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0a0a0a; color: #d4af37; font-family: 'Montserrat', sans-serif; min-height: 100vh; }
    .header { text-align: center; padding: 50px; border-bottom: 3px solid #d4af37; }
    .header h1 { font-family: 'Cinzel', serif; font-size: 3.8rem; letter-spacing: 8px; }
    .container { max-width: 1200px; margin: 40px auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 40px; }
    .card { background: rgba(20,20,20,0.9); padding: 35px; border-radius: 18px; border: 2px solid #d4af37; }
    .card h2 { font-family: 'Cinzel', serif; font-size: 2.2rem; text-align: center; margin-bottom: 30px; }
    label { display: block; margin: 15px 0 8px; font-weight: 500; }
    input[type="text"], textarea { width: 100%; padding: 14px; background: #111; border: 2px solid #d4af37; color: #d4af37; border-radius: 10px; }
    .btn { padding: 14px; background: #d4af37; color: #000; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; margin-top: 20px; width: 100%; }
    .btn:hover { background: #ffd700; }
    .btn-danger { background: #8b0000; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 15px; border-bottom: 1px solid #444; text-align: left; }
    th { background: #222; }
    .preview-img { max-width: 100px; margin-top: 10px; border-radius: 8px; border: 1px solid #d4af37; }
    .status { text-align: center; padding: 15px; border-radius: 8px; margin: 20px auto; max-width: 800px; }
    .status.success { background: rgba(0,255,0,0.2); color: #0f0; }
    .status.error { background: rgba(255,0,0,0.2); color: #ff6b6b; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400&display=swap" rel="stylesheet">

  <!-- Hanya Firebase Realtime Database (tanpa Storage) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyALIhKFz4bpOPmES6t2fAdx8VMPP0ye1wc",
      authDomain: "rhf-resmi.firebaseapp.com",
      projectId: "rhf-resmi",
      databaseURL: "https://rhf-resmi-default-rtdb.asia-southeast1.firebasedatabase.app",
      appId: "1:313439235544:web:b19a2ad538e34c1fe516ad"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const configRef = db.ref('config');
    const codesRef = db.ref('accessCodes');
    let editingKey = null;

    const statusEl = document.getElementById('status');
    const addButton = document.getElementById('addButton');

    window.onload = () => {
      loadConfig();
      loadCodes();
      setStatus('Terhubung (tanpa Storage)', 'success');
    };

    function setStatus(msg, type = 'success') {
      statusEl.textContent = msg;
      statusEl.className = 'status ' + type;
    }

    function loadConfig() { /* sama seperti sebelumnya */ }

    function saveConfig() { /* sama */ }

    function loadCodes() {
      codesRef.on('value', snap => {
        const codes = snap.val() || {};
        const tbody = document.getElementById('codesBody');
        tbody.innerHTML = '';
        Object.keys(codes).forEach(key => {
          const item = codes[key];
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><strong>${item.code}</strong></td>
            <td>${item.notes || '-'}</td>
            <td>${item.download_link ? '<a href="' + item.download_link + '" target="_blank">Link</a>' : '-'}</td>
            <td>${item.logo_url ? '<img src="' + item.logo_url + '" class="preview-img">' : '-'}</td>
            <td>${item.license_url ? '<img src="' + item.license_url + '" class="preview-img">' : '-'}</td>
            <td>
              <button class="btn" onclick="editCode('${key}')">EDIT</button>
              <button class="btn btn-danger" onclick="deleteCode('${key}')">HAPUS</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      });
    }

    function editCode(key) {
      codesRef.child(key).once('value').then(snap => {
        const item = snap.val();
        editingKey = key;
        document.getElementById('newCode').value = item.code || '';
        document.getElementById('notes').value = item.notes || '';
        document.getElementById('downloadLink').value = item.download_link || '';
        document.getElementById('logoUrl').value = item.logo_url || '';
        document.getElementById('licenseUrl').value = item.license_url || '';
        document.getElementById('logoPreview').innerHTML = item.logo_url ? `<img src="${item.logo_url}" class="preview-img">` : '';
        document.getElementById('licensePreview').innerHTML = item.license_url ? `<img src="${item.license_url}" class="preview-img">` : '';
        addButton.textContent = 'UPDATE KODE';
      });
    }

    async function addOrUpdateCode() {
      addButton.disabled = true;
      setStatus('Menyimpan...', 'success');

      const code = document.getElementById('newCode').value.trim().toUpperCase();
      const notes = document.getElementById('notes').value.trim();
      const downloadLink = document.getElementById('downloadLink').value.trim();
      const logoUrl = document.getElementById('logoUrl').value.trim();
      const licenseUrl = document.getElementById('licenseUrl').value.trim();

      if (!code) {
        setStatus('Kode wajib diisi!', 'error');
        addButton.disabled = false;
        return;
      }

      const data = {
        code,
        notes: notes || null,
        download_link: downloadLink || null,
        logo_url: logoUrl || null,
        license_url: licenseUrl || null,
        updatedAt: Date.now()
      };

      try {
        if (editingKey) {
          await codesRef.child(editingKey).set(data);
          setStatus('Kode berhasil diupdate!', 'success');
        } else {
          await codesRef.push(data);
          setStatus('Kode baru berhasil ditambahkan!', 'success');
        }
        resetForm();
      } catch (error) {
        setStatus('Gagal: ' + error.message + ' (Cek Database Rules!)', 'error');
      }
      addButton.disabled = false;
    }

    function resetForm() {
      editingKey = null;
      document.getElementById('newCode').value = '';
      document.getElementById('notes').value = '';
      document.getElementById('downloadLink').value = '';
      document.getElementById('logoUrl').value = '';
      document.getElementById('licenseUrl').value = '';
      document.getElementById('logoPreview').innerHTML = '';
      document.getElementById('licensePreview').innerHTML = '';
      addButton.textContent = 'TAMBAH KODE';
    }

    function deleteCode(key) {
      if (confirm('Yakin hapus?')) {
        codesRef.child(key).remove().then(() => setStatus('Kode dihapus', 'success'));
      }
    }
  </script>
</head>
<body>

  <div class="header">
    <h1>ADMIN DASHBOARD</h1>
    <p>(Tanpa Storage - Gunakan Link HTTPS untuk Gambar)</p>
  </div>

  <div id="status" class="status">Memuat...</div>

  <div class="container">

    <div class="card">
      <h2>Pengaturan Teks</h2>
      <!-- Field teks sama seperti sebelumnya -->
      <button class="btn" onclick="saveConfig()">SIMPAN TEKS</button>
    </div>

    <div class="card">
      <h2>Kelola Kode Akses</h2>
      <label>Kode Akses</label>
      <input type="text" id="newCode" placeholder="VIP-2026">

      <label>Catatan</label>
      <textarea id="notes"></textarea>

      <label>Link Download</label>
      <input type="text" id="downloadLink" placeholder="https://link-download.com/file">

      <label>Link Logo (HTTPS)</label>
      <input type="text" id="logoUrl" placeholder="https://i.ibb.co/xxx/logo.png">
      <div id="logoPreview"></div>

      <label>Link Cap Lisensi RHF (HTTPS)</label>
      <input type="text" id="licenseUrl" placeholder="https://i.ibb.co/xxx/cap-rhf.png">
      <div id="licensePreview"></div>

      <button class="btn" id="addButton" onclick="addOrUpdateCode()">TAMBAH KODE</button>

      <table>
        <thead><tr><th>Kode</th><th>Catatan</th><th>Download</th><th>Logo</th><th>Cap</th><th>Aksi</th></tr></thead>
        <tbody id="codesBody"></tbody>
      </table>
    </div>

  </div>

</body>
</html>
